
> profe-ai@1.0.0 test:coverage:check
> vitest run --coverage

Warning: Starting in Storybook 8.5.0-alpha.18, the "test.include" option in Vitest is discouraged in favor of just using the "stories" field in your Storybook configuration.

The values you passed to "test.include" will be ignored, please remove them from your Vitest configuration where the Storybook plugin is applied.

More info: https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#addon-test-indexing-behavior-of-storybookaddon-test-is-changed

[1m[46m RUN [49m[22m [36mv4.0.17 [39m[90m/Users/elena/Developer/ProfeAI[39m
      [2mCoverage enabled with [22m[33mv8[39m

Warning: Starting in Storybook 8.5.0-alpha.18, the "test.include" option in Vitest is discouraged in favor of just using the "stories" field in your Storybook configuration.

The values you passed to "test.include" will be ignored, please remove them from your Vitest configuration where the Storybook plugin is applied.

More info: https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#addon-test-indexing-behavior-of-storybookaddon-test-is-changed
[90mstdout[2m | src/tests/flashcard/useTTS.test.ts[2m > [22m[2museTTS[2m > [22m[2musa backend TTS cuando estÃ¡ disponible
[22m[39mğŸ™ï¸ Attempting backend TTS...

[90mstderr[2m | src/tests/flashcard/useTTS.test.ts[2m > [22m[2museTTS[2m > [22m[2musa backend TTS cuando estÃ¡ disponible
[22m[39mWarning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (/Users/elena/Developer/ProfeAI/node_modules/@testing-library/react/dist/pure.js:329:5)
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (/Users/elena/Developer/ProfeAI/node_modules/@testing-library/react/dist/pure.js:329:5)

[90mstdout[2m | src/tests/flashcard/useTTS.test.ts[2m > [22m[2museTTS[2m > [22m[2musa backend TTS cuando estÃ¡ disponible
[22m[39mâœ… TTS successful using elevenlabs

[90mstdout[2m | src/tests/flashcard/useTTS.test.ts[2m > [22m[2museTTS[2m > [22m[2mhace fallback a Web Speech API cuando el backend falla
[22m[39mğŸ™ï¸ Attempting backend TTS...

[90mstderr[2m | src/tests/flashcard/useTTS.test.ts[2m > [22m[2museTTS[2m > [22m[2mhace fallback a Web Speech API cuando el backend falla
[22m[39mâš ï¸ Backend TTS failed. Status: [90mundefined[39m
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (/Users/elena/Developer/ProfeAI/node_modules/@testing-library/react/dist/pure.js:329:5)

[90mstdout[2m | src/tests/flashcard/useTTS.test.ts[2m > [22m[2museTTS[2m > [22m[2mhace fallback a Web Speech API cuando el backend falla
[22m[39mAvailable Spanish voices: 1
âš ï¸ Using any premium voice (may not match gender): Google espaÃ±ol
ğŸ¤ Browser Voice Selected: Google espaÃ±ol (es-ES) - Gender: female
ğŸ‘© Female voice parameters: rate=0.95, pitch=1.1

[90mstdout[2m | src/tests/flashcard/useTTS.test.ts[2m > [22m[2museTTS[2m > [22m[2mhace fallback a Web Speech API cuando el backend falla
[22m[39mâœ… Using Web Speech API fallback

 [32mâœ“[39m [30m[43m 0 [49m[39m src/tests/flashcard/FlashcardTranslation.test.tsx [2m([22m[2m2 tests[22m[2m)[22m[32m 21[2mms[22m[39m
[90mstdout[2m | src/tests/flashcard/useTTS.test.ts[2m > [22m[2museTTS[2m > [22m[2mhace fallback a Web Speech API cuando el servidor no estÃ¡ disponible
[22m[39mğŸ™ï¸ Attempting backend TTS...

[90mstdout[2m | src/tests/flashcard/useTTS.test.ts[2m > [22m[2museTTS[2m > [22m[2mhace fallback a Web Speech API cuando el servidor no estÃ¡ disponible
[22m[39mAvailable Spanish voices: 1
âš ï¸ Using any premium voice (may not match gender): Google espaÃ±ol
ğŸ¤ Browser Voice Selected: Google espaÃ±ol (es-ES) - Gender: female
ğŸ‘© Female voice parameters: rate=0.95, pitch=1.1

[90mstderr[2m | src/tests/flashcard/useTTS.test.ts[2m > [22m[2museTTS[2m > [22m[2mhace fallback a Web Speech API cuando el servidor no estÃ¡ disponible
[22m[39mâš ï¸ Backend unreachable: Network error
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (/Users/elena/Developer/ProfeAI/node_modules/@testing-library/react/dist/pure.js:329:5)

[90mstdout[2m | src/tests/flashcard/useTTS.test.ts[2m > [22m[2museTTS[2m > [22m[2mhace fallback a Web Speech API cuando el servidor no estÃ¡ disponible
[22m[39mâœ… Using Web Speech API fallback

[90mstdout[2m | src/tests/flashcard/useTTS.test.ts[2m > [22m[2museTTS[2m > [22m[2mactualiza currentProvider segÃºn el proveedor usado
[22m[39mğŸ™ï¸ Attempting backend TTS...

[90mstderr[2m | src/tests/flashcard/useTTS.test.ts[2m > [22m[2museTTS[2m > [22m[2mactualiza currentProvider segÃºn el proveedor usado
[22m[39mWarning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (/Users/elena/Developer/ProfeAI/node_modules/@testing-library/react/dist/pure.js:329:5)
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (/Users/elena/Developer/ProfeAI/node_modules/@testing-library/react/dist/pure.js:329:5)

[90mstdout[2m | src/tests/flashcard/useTTS.test.ts[2m > [22m[2museTTS[2m > [22m[2mactualiza currentProvider segÃºn el proveedor usado
[22m[39mâœ… TTS successful using google

 [32mâœ“[39m [30m[43m 0 [49m[39m src/tests/flashcard/Flashcard.test.tsx [2m([22m[2m2 tests[22m[2m)[22m[32m 36[2mms[22m[39m
 [32mâœ“[39m [30m[43m 0 [49m[39m src/tests/flashcard/FlashcardActions.test.tsx [2m([22m[2m3 tests[22m[2m)[22m[32m 35[2mms[22m[39m
[90mstderr[2m | src/tests/components/DialogueViewer.test.tsx[2m > [22m[2mDialogueViewer[2m > [22m[2mcalls speak when the audio button is clicked
[22m[39mWarning: An update to DialogueViewer inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at DialogueViewer (/Users/elena/Developer/ProfeAI/src/components/DialogueViewer.tsx:8:27)

 [32mâœ“[39m [30m[43m 0 [49m[39m src/tests/components/DialogueViewer.test.tsx [2m([22m[2m3 tests[22m[2m)[22m[32m 74[2mms[22m[39m
[90mstdout[2m | src/tests/flashcard/useTTS.test.ts[2m > [22m[2museTTS[2m > [22m[2mdetiene el audio actual antes de reproducir uno nuevo
[22m[39mğŸ™ï¸ Attempting backend TTS...

[90mstdout[2m | src/tests/flashcard/useTTS.test.ts[2m > [22m[2museTTS[2m > [22m[2mdetiene el audio actual antes de reproducir uno nuevo
[22m[39mâœ… TTS successful using elevenlabs

[90mstderr[2m | src/tests/flashcard/useTTS.test.ts[2m > [22m[2museTTS[2m > [22m[2mdetiene el audio actual antes de reproducir uno nuevo
[22m[39mWarning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (/Users/elena/Developer/ProfeAI/node_modules/@testing-library/react/dist/pure.js:329:5)
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (/Users/elena/Developer/ProfeAI/node_modules/@testing-library/react/dist/pure.js:329:5)

 [32mâœ“[39m [30m[43m 0 [49m[39m src/tests/flashcard/useTTS.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 128[2mms[22m[39m
 [32mâœ“[39m [30m[43m 0 [49m[39m src/tests/components/auth/AuthForms.test.tsx [2m([22m[2m4 tests[22m[2m)[22m[32m 186[2mms[22m[39m
 [32mâœ“[39m [30m[43m 0 [49m[39m src/tests/pages/ProfilePage.test.tsx [2m([22m[2m2 tests[22m[2m)[22m[32m 28[2mms[22m[39m
 [32mâœ“[39m [30m[43m 0 [49m[39m src/tests/services/UserService.test.ts [2m([22m[2m20 tests[22m[2m)[22m[32m 15[2mms[22m[39m
[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mCaching Logic[2m > [22m[2mshould return cached audio if file exists
[22m[39mâœ… Amazon Polly configured

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mCaching Logic[2m > [22m[2mshould return cached audio if file exists
[22m[39mğŸ’¾ Cache HIT: /Users/elena/Developer/ProfeAI/cache/tts/b14030b989bc025d4760c1405609d369.mp3

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mCaching Logic[2m > [22m[2mshould save to cache after generating audio (Cache MISS)
[22m[39mâœ… Amazon Polly configured

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mCaching Logic[2m > [22m[2mshould save to cache after generating audio (Cache MISS)
[22m[39mâŒ Cache MISS: /Users/elena/Developer/ProfeAI/cache/tts/b14030b989bc025d4760c1405609d369.mp3
ğŸ™ï¸ TTS: ElevenLabs (female)...
Using ElevenLabs Voice ID: t5ztDJA7pj9EyW9QIcJ2 (female)

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mCaching Logic[2m > [22m[2mshould save to cache after generating audio (Cache MISS)
[22m[39mğŸ’¾ Saved to cache: /Users/elena/Developer/ProfeAI/cache/tts/b14030b989bc025d4760c1405609d369.mp3

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mCaching Logic[2m > [22m[2mshould handle cache write errors gracefully
[22m[39mâœ… Amazon Polly configured

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mCaching Logic[2m > [22m[2mshould handle cache write errors gracefully
[22m[39mâŒ Cache MISS: /Users/elena/Developer/ProfeAI/cache/tts/b14030b989bc025d4760c1405609d369.mp3
ğŸ™ï¸ TTS: ElevenLabs (female)...
Using ElevenLabs Voice ID: t5ztDJA7pj9EyW9QIcJ2 (female)

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mCaching Logic[2m > [22m[2mshould handle cache read errors gracefully (treat as miss)
[22m[39mâœ… Amazon Polly configured

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mCaching Logic[2m > [22m[2mshould handle cache read errors gracefully (treat as miss)
[22m[39mğŸ’¾ Cache HIT: /Users/elena/Developer/ProfeAI/cache/tts/b14030b989bc025d4760c1405609d369.mp3
ğŸ™ï¸ TTS: ElevenLabs (female)...
Using ElevenLabs Voice ID: t5ztDJA7pj9EyW9QIcJ2 (female)

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateWithElevenLabs[2m > [22m[2mgenera audio exitosamente con ElevenLabs
[22m[39mâœ… Amazon Polly configured

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateWithElevenLabs[2m > [22m[2mgenera audio exitosamente con ElevenLabs
[22m[39mUsing ElevenLabs Voice ID: t5ztDJA7pj9EyW9QIcJ2 (female)

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateWithElevenLabs[2m > [22m[2mthrows QUOTA_EXCEEDED error
[22m[39mâœ… Amazon Polly configured

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateWithElevenLabs[2m > [22m[2mthrows QUOTA_EXCEEDED error
[22m[39mUsing ElevenLabs Voice ID: t5ztDJA7pj9EyW9QIcJ2 (female)

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateWithElevenLabs[2m > [22m[2mthrows general error
[22m[39mâœ… Amazon Polly configured

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateWithElevenLabs[2m > [22m[2mthrows general error
[22m[39mUsing ElevenLabs Voice ID: t5ztDJA7pj9EyW9QIcJ2 (female)

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateWithElevenLabs[2m > [22m[2mthrows if API key missing
[22m[39mâœ… Amazon Polly configured

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateWithPolly[2m > [22m[2mgenerates audio successfully
[22m[39mâœ… Amazon Polly configured

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateWithPolly[2m > [22m[2mthrows if no audio stream returned
[22m[39mâœ… Amazon Polly configured

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateWithPolly[2m > [22m[2mthrows if client not initialized
[22m[39mâœ… Amazon Polly configured

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateWithGoogle[2m > [22m[2mgenerates audio successfully
[22m[39mâœ… Amazon Polly configured

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateWithGoogle[2m > [22m[2mthrows if no audio content
[22m[39mâœ… Amazon Polly configured

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateWithGoogle[2m > [22m[2mthrows if api key missing
[22m[39mâœ… Amazon Polly configured

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateSpeech (fallback logic)[2m > [22m[2mintenta ElevenLabs primero
[22m[39mâœ… Amazon Polly configured

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateSpeech (fallback logic)[2m > [22m[2mintenta ElevenLabs primero
[22m[39mâŒ Cache MISS: /Users/elena/Developer/ProfeAI/cache/tts/b14030b989bc025d4760c1405609d369.mp3
ğŸ™ï¸ TTS: ElevenLabs (female)...
Using ElevenLabs Voice ID: t5ztDJA7pj9EyW9QIcJ2 (female)

[90mstderr[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateSpeech (fallback logic)[2m > [22m[2mintenta ElevenLabs primero
[22m[39mâš ï¸ Could not write to cache: Error: Write perm
    at Object.<anonymous> [90m(/Users/elena/Developer/ProfeAI/[39msrc/tests/services/TTSService.test.ts:103:63[90m)[39m
    at Object.Mock [as writeFileSync] [90m(file:///Users/elena/Developer/ProfeAI/[39mnode_modules/[4mvitest[24m/node_modules/[4m@vitest/spy[24m/dist/index.js:285:34[90m)[39m
    at TTSService.generateSpeech [90m(/Users/elena/Developer/ProfeAI/[39msrc/services/TTSService.ts:302:16[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/Users/elena/Developer/ProfeAI/[39msrc/tests/services/TTSService.test.ts:235:22
    at [90mfile:///Users/elena/Developer/ProfeAI/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateSpeech (fallback logic)[2m > [22m[2mfallback to Polly if ElevenLabs fails
[22m[39mâœ… Amazon Polly configured

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateSpeech (fallback logic)[2m > [22m[2mfallback to Polly if ElevenLabs fails
[22m[39mâŒ Cache MISS: /Users/elena/Developer/ProfeAI/cache/tts/b14030b989bc025d4760c1405609d369.mp3
ğŸ™ï¸ TTS: ElevenLabs (female)...
Using ElevenLabs Voice ID: t5ztDJA7pj9EyW9QIcJ2 (female)

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateSpeech (fallback logic)[2m > [22m[2mfallback to Polly if ElevenLabs fails
[22m[39mğŸ™ï¸ TTS: Amazon Polly (female)...

[90mstderr[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateSpeech (fallback logic)[2m > [22m[2mfallback to Polly if ElevenLabs fails
[22m[39mâš ï¸ ElevenLabs fallÃ³: ElevenLabs error: Error

[90mstderr[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateSpeech (fallback logic)[2m > [22m[2mfallback to Polly if ElevenLabs fails
[22m[39mâš ï¸ Could not write to cache: Error: Write perm
    at Object.<anonymous> [90m(/Users/elena/Developer/ProfeAI/[39msrc/tests/services/TTSService.test.ts:103:63[90m)[39m
    at Object.Mock [as writeFileSync] [90m(file:///Users/elena/Developer/ProfeAI/[39mnode_modules/[4mvitest[24m/node_modules/[4m@vitest/spy[24m/dist/index.js:285:34[90m)[39m
    at TTSService.generateSpeech [90m(/Users/elena/Developer/ProfeAI/[39msrc/services/TTSService.ts:302:16[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/Users/elena/Developer/ProfeAI/[39msrc/tests/services/TTSService.test.ts:253:22
    at [90mfile:///Users/elena/Developer/ProfeAI/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateSpeech (fallback logic)[2m > [22m[2mfallback to Google if Polly fails
[22m[39mâœ… Amazon Polly configured

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateSpeech (fallback logic)[2m > [22m[2mfallback to Google if Polly fails
[22m[39mâŒ Cache MISS: /Users/elena/Developer/ProfeAI/cache/tts/b14030b989bc025d4760c1405609d369.mp3
ğŸ™ï¸ TTS: ElevenLabs (female)...
Using ElevenLabs Voice ID: t5ztDJA7pj9EyW9QIcJ2 (female)

[90mstderr[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateSpeech (fallback logic)[2m > [22m[2mfallback to Google if Polly fails
[22m[39mâš ï¸ ElevenLabs fallÃ³: ElevenLabs error: Error

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateSpeech (fallback logic)[2m > [22m[2mfallback to Google if Polly fails
[22m[39mğŸ™ï¸ TTS: Amazon Polly (female)...

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateSpeech (fallback logic)[2m > [22m[2mfallback to Google if Polly fails
[22m[39mğŸ™ï¸ TTS: Google Cloud (female)...

[90mstderr[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateSpeech (fallback logic)[2m > [22m[2mfallback to Google if Polly fails
[22m[39mâš ï¸ Polly fallÃ³: Polly Error

[90mstderr[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateSpeech (fallback logic)[2m > [22m[2mfallback to Google if Polly fails
[22m[39mâš ï¸ Could not write to cache: Error: Write perm
    at Object.<anonymous> [90m(/Users/elena/Developer/ProfeAI/[39msrc/tests/services/TTSService.test.ts:103:63[90m)[39m
    at Object.Mock [as writeFileSync] [90m(file:///Users/elena/Developer/ProfeAI/[39mnode_modules/[4mvitest[24m/node_modules/[4m@vitest/spy[24m/dist/index.js:285:34[90m)[39m
    at TTSService.generateSpeech [90m(/Users/elena/Developer/ProfeAI/[39msrc/services/TTSService.ts:302:16[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/Users/elena/Developer/ProfeAI/[39msrc/tests/services/TTSService.test.ts:272:22
    at [90mfile:///Users/elena/Developer/ProfeAI/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateSpeech (fallback logic)[2m > [22m[2mthrows if ALL providers fail
[22m[39mâœ… Amazon Polly configured

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateSpeech (fallback logic)[2m > [22m[2mthrows if ALL providers fail
[22m[39mâŒ Cache MISS: /Users/elena/Developer/ProfeAI/cache/tts/b14030b989bc025d4760c1405609d369.mp3
ğŸ™ï¸ TTS: ElevenLabs (female)...
Using ElevenLabs Voice ID: t5ztDJA7pj9EyW9QIcJ2 (female)

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateSpeech (fallback logic)[2m > [22m[2mthrows if ALL providers fail
[22m[39mğŸ™ï¸ TTS: Amazon Polly (female)...

[90mstderr[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateSpeech (fallback logic)[2m > [22m[2mthrows if ALL providers fail
[22m[39mâš ï¸ ElevenLabs fallÃ³: EL Error

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateSpeech (fallback logic)[2m > [22m[2mthrows if ALL providers fail
[22m[39mğŸ™ï¸ TTS: Google Cloud (female)...

[90mstderr[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateSpeech (fallback logic)[2m > [22m[2mthrows if ALL providers fail
[22m[39mâš ï¸ Polly fallÃ³: Polly Error

[90mstderr[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgenerateSpeech (fallback logic)[2m > [22m[2mthrows if ALL providers fail
[22m[39mâš ï¸ Google fallÃ³: Google Error

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2mgetProviderStatus[2m > [22m[2mreturns status object
[22m[39mâœ… Amazon Polly configured

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2minitialization[2m > [22m[2mcreates cache dir if missing
[22m[39mâœ… Amazon Polly configured

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2minitialization[2m > [22m[2minitializes only once
[22m[39mâœ… Amazon Polly configured

[90mstdout[2m | src/tests/services/TTSService.test.ts[2m > [22m[2mTTSService[2m > [22m[2minitialization[2m > [22m[2minitializes only once
[22m[39mâœ… Amazon Polly configured

[90mstdout[2m | src/tests/services/LessonService.test.ts[2m > [22m[2mLessonService[2m > [22m[2msetLesson[2m > [22m[2mshould write lesson data
[22m[39mLesson lesson_id written successfully.

 [32mâœ“[39m [30m[43m 0 [49m[39m src/tests/services/TTSService.test.ts [2m([22m[2m21 tests[22m[2m)[22m[32m 19[2mms[22m[39m
 [32mâœ“[39m [30m[43m 0 [49m[39m src/tests/services/LessonService.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 8[2mms[22m[39m
 [31mâ¯[39m [30m[43m 0 [49m[39m src/tests/flashcard/integration/FlashcardFlow.integration.test.tsx [2m([22m[2m0 test[22m[2m)[22m
 [32mâœ“[39m [30m[43m 0 [49m[39m src/tests/flashcard/FlashcardAudioButtons.test.tsx [2m([22m[2m3 tests[22m[2m)[22m[32m 15[2mms[22m[39m
 [32mâœ“[39m [30m[45m storybook (chromium) [49m[39m src/stories/FlashcardActions.stories.tsx [2m([22m[2m2 tests[22m[2m)[22m[33m 534[2mms[22m[39m
   [33m[2mâœ“[22m[39m Default [33m 485[2mms[22m[39m
 [32mâœ“[39m [30m[45m storybook (chromium) [49m[39m src/stories/FlashcardText.stories.tsx [2m([22m[2m2 tests[22m[2m)[22m[33m 538[2mms[22m[39m
   [33m[2mâœ“[22m[39m Hidden [33m 483[2mms[22m[39m
 [32mâœ“[39m [30m[45m storybook (chromium) [49m[39m src/stories/AuthForms.stories.tsx [2m([22m[2m2 tests[22m[2m)[22m[33m 532[2mms[22m[39m
   [33m[2mâœ“[22m[39m Login [33m 460[2mms[22m[39m
 [32mâœ“[39m [30m[45m storybook (chromium) [49m[39m src/stories/Flashcard.stories.tsx [2m([22m[2m2 tests[22m[2m)[22m[33m 574[2mms[22m[39m
   [33m[2mâœ“[22m[39m Default [33m 489[2mms[22m[39m
 [32mâœ“[39m [30m[45m storybook (chromium) [49m[39m src/stories/Page.stories.js [2m([22m[2m2 tests[22m[2m)[22m[33m 631[2mms[22m[39m
   [33m[2mâœ“[22m[39m Logged Out [33m 498[2mms[22m[39m
 [32mâœ“[39m [30m[45m storybook (chromium) [49m[39m src/stories/Button.stories.js [2m([22m[2m5 tests[22m[2m)[22m[33m 1024[2mms[22m[39m
   [33m[2mâœ“[22m[39m Primary [33m 495[2mms[22m[39m
   [33m[2mâœ“[22m[39m Small [33m 385[2mms[22m[39m
 [32mâœ“[39m [30m[45m storybook (chromium) [49m[39m src/stories/GrammarReport.stories.tsx [2m([22m[2m3 tests[22m[2m)[22m[33m 968[2mms[22m[39m
   [33m[2mâœ“[22m[39m With Results [33m 487[2mms[22m[39m
   [33m[2mâœ“[22m[39m Empty [33m 374[2mms[22m[39m
 [32mâœ“[39m [30m[45m storybook (chromium) [49m[39m src/stories/Header.stories.js [2m([22m[2m2 tests[22m[2m)[22m[32m 167[2mms[22m[39m
[90mstderr[2m | src/stories/ConversationMode.stories.tsx[2m > [22m[2mDefault
[22m[39mChat Error: [TypeError: res.json is not a function]
 [32mâœ“[39m [30m[45m storybook (chromium) [49m[39m src/stories/TailwindTest.stories.jsx [2m([22m[2m1 test[22m[2m)[22m[32m 144[2mms[22m[39m
 [32mâœ“[39m [30m[45m storybook (chromium) [49m[39m src/stories/DialogueGenerator.stories.tsx [2m([22m[2m1 test[22m[2m)[22m[32m 186[2mms[22m[39m
 [32mâœ“[39m [30m[45m storybook (chromium) [49m[39m src/stories/FlashcardAudioButtons.stories.tsx [2m([22m[2m1 test[22m[2m)[22m[32m 167[2mms[22m[39m
 [32mâœ“[39m [30m[45m storybook (chromium) [49m[39m src/stories/Sidebar.stories.tsx [2m([22m[2m1 test[22m[2m)[22m[32m 178[2mms[22m[39m
 [32mâœ“[39m [30m[45m storybook (chromium) [49m[39m src/stories/Navbar.stories.tsx [2m([22m[2m1 test[22m[2m)[22m[32m 154[2mms[22m[39m
 [32mâœ“[39m [30m[45m storybook (chromium) [49m[39m src/stories/ConversationMode.stories.tsx [2m([22m[2m1 test[22m[2m)[22m[32m 235[2mms[22m[39m

[31mâ¯â¯â¯â¯â¯â¯[39m[1m[41m Failed Suites 1 [49m[22m[31mâ¯â¯â¯â¯â¯â¯â¯[39m

[41m[1m FAIL [22m[49m [30m[43m 0 [49m[39m src/tests/flashcard/integration/FlashcardFlow.integration.test.tsx[2m [ src/tests/flashcard/integration/FlashcardFlow.integration.test.tsx ][22m
[31m[1mError[22m: Failed to resolve import "../../../../utils/loadLessons" from "src/tests/flashcard/integration/FlashcardFlow.integration.test.tsx". Does the file exist?[39m
  Plugin: [35mvite:import-analysis[39m
  File: [36m/Users/elena/Developer/ProfeAI/src/tests/flashcard/integration/FlashcardFlow.integration.test.tsx[39m:4:0
[33m  16 |  const __vi_import_1__ = await import("@testing-library/react");
  17 |  const __vi_import_2__ = await import("../../../App");
  18 |  const __vi_import_3__ = await import("../../../../utils/loadLessons");
     |                                       ^
  19 |  
  20 |  [39m
[90m [2mâ¯[22m TransformPluginContext._formatLog node_modules/vite/dist/node/chunks/config.js:[2m29647:43[22m[39m
[90m [2mâ¯[22m TransformPluginContext.error node_modules/vite/dist/node/chunks/config.js:[2m29644:14[22m[39m
[90m [2mâ¯[22m normalizeUrl node_modules/vite/dist/node/chunks/config.js:[2m27767:18[22m[39m
[90m [2mâ¯[22m node_modules/vite/dist/node/chunks/config.js:[2m27825:32[22m[39m
[90m [2mâ¯[22m TransformPluginContext.transform node_modules/vite/dist/node/chunks/config.js:[2m27793:4[22m[39m
[90m [2mâ¯[22m EnvironmentPluginContainer.transform node_modules/vite/dist/node/chunks/config.js:[2m29445:14[22m[39m
[90m [2mâ¯[22m loadAndTransform node_modules/vite/dist/node/chunks/config.js:[2m23316:26[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/1]â¯[22m[39m


[2m Test Files [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m25 passed[39m[22m[90m (26)[39m
[2m      Tests [22m [1m[32m96 passed[39m[22m[90m (96)[39m
[2m   Start at [22m 17:27:32
[2m   Duration [22m 5.85s[2m (transform 523ms, setup 7.59s, import 4.20s, tests 6.60s, environment 2.93s)[22m

